---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: minecraft-unexpected-join-alert
  namespace: games
  labels:
    prometheusrule: "true"
spec:
  groups:
    - name: minecraft-alerts
      rules:
        - alert: UnexpectedMinecraftJavaJoin
          expr: |
            count_over_time(({namespace="games", app="minecraft-java"} |~ "User Authenticator" |~ "UUID of player" | regexp `UUID of player (?P<player>\S+) is (?P<uuid>\S+)` | player !~ "BinaryNexus|HellsOperative|THEEARIESHD|Kendrikson|InTheClouds221|MermaidMobTies|StarRider88")[5m]) > 0
          for: 5m
          annotations:
            summary: "An unexpected player has attempted to join the Minecraft server."
            description: "Player '{{ $labels.player }}' with UUID '{{ $labels.uuid }}' attempted to join the server."
          labels:
            severity: critical
